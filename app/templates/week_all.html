{# app/templates/week_all.html #}
{% extends "base.html" %}

{% block page_content %}

<div class="page-header">
    <div class="page-header-left">
        <a href="/week?year={{ year - 1 }}&week={{ week }}" class="btn btn-primary">Previous year</a>
        <a href="/week?year={{ prev_year }}&week={{ prev_week }}" class="btn btn-primary">Prev week</a>
        <a href="/week" class="btn btn-primary">Today</a>
        <a href="/week?year={{ next_year }}&week={{ next_week }}" class="btn btn-primary">Next week</a>
        <a href="/week?year={{ year + 1 }}&week={{ week }}" class="btn btn-primary">Next year</a>
    </div>

    <div class="page-header-right">
        {# Visa bara länk till egen week-sida, eller alla om admin #}
        {% if user and user.role.value == 'admin' %}
            {% for i in range(1, 11) %}
                <a href="/week/{{ i }}?year={{ year }}&week={{ week }}" class="btn secondary">
                    {{ i }}
                </a>
            {% endfor %}
        {% elif user %}
            <a href="/week/{{ user.id }}?year={{ year }}&week={{ week }}" class="btn secondary">Min vecka</a>
        {% endif %}
    </div>
</div>

<h2 class="page-title">Week {{ week }} {{ year }} - All persons</h2>

<table class="month-schedule table-sticky">
        <thead>
            <tr>
                <th style="min-width:120px">Day</th>
                <th style="min-width:140px">Date</th>
                {% if days and days|length > 0 %}
                    {% for p in days[0].persons %}
                        <th class="person-header">
                            {# Länka bara till egen sida eller om admin #}
                            {% if user and (user.role.value == 'admin' or user.id == p.person_id) %}
                                <a href="/week/{{ p.person_id }}?year={{ year }}&week={{ week }}">
                                    {{ p.person_name }}<br>
                                    <small>(#{{ p.person_id }})</small>
                                </a>
                            {% else %}
                                {{ p.person_name }}<br>
                                <small>(#{{ p.person_id }})</small>
                            {% endif %}
                        </th>
                    {% endfor %}
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for day in days %}
                <tr class="shift-row {% if today is defined and day.date == today %}today-row{% endif %}">
                    <td class="day-cell" data-label="Dag">{{ day.weekday_name }}</td>
                    <td class="date-cell" data-label="Datum">{{ day.date }}</td>
                    {% for person in day.persons %}
                        <td data-label="{{ person.person_name }}" style="border-left:6px solid {% if person.shift %}{{ person.shift.color }}{% else %}transparent{% endif %}; padding-left:8px;">
                            {% if person.shift %}
                                {# Länka till day-sida bara om admin eller egen #}
                                {% if user and (user.role.value == 'admin' or user.id == person.person_id) %}
                                    <a href="/day/{{ person.person_id }}/{{ day.date.year }}/{{ day.date.month }}/{{ day.date.day }}"
                                       style="text-decoration:none;">
                                {% endif %}
                                    {% if person.shift.code == 'SEM' %}
                                        <span class="badge badge-sem"
                                              title="Semester"
                                              style="background: {{ person.shift.color }}; color: {{ person.shift.color | contrast }};">
                                            SEM
                                        </span>
                                    {% elif person.shift.code == 'OT' %}
                                        <span class="badge"
                                              title="{% if person.start and person.end %}Övertid: {{ person.start.strftime('%H:%M') }} - {{ person.end.strftime('%H:%M') }}{% else %}Övertid (tider saknas){% endif %}"
                                              style="background: {{ person.shift.color }}; color: {{ person.shift.color | contrast }};">
                                            OT
                                        </span>
                                    {% else %}
                                        <span class="badge"
                                              style="background: {{ person.shift.color }}; color: {{ person.shift.color | contrast }};">
                                            {{ person.shift.code }}
                                        </span>
                                    {% endif %}
                                {% if user and (user.role.value == 'admin' or user.id == person.person_id) %}
                                    </a>
                                {% endif %}
                            {% else %}
                                <span class="badge badge-off">OFF</span>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}
