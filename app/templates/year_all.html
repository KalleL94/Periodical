{# app/templates/year_all.html #}
{% extends "base.html" %}

{% block page_content %}

<div class="page-header">
    <div class="page-header-left">
        <a href="/year?year={{ year - 1 }}" class="btn btn-primary">Previous year</a>
        <a href="/year" class="btn btn-primary">Today</a>
        <a href="/year?year={{ year + 1 }}" class="btn btn-primary">Next year</a>
    </div>

    <div class="page-header-right">
        {% for i in range(1, 11) %}
            <a href="/year/{{ i }}?year={{ year }}" class="btn secondary">{{ i }}</a>
        {% endfor %}
    </div>
</div>

<h2 class="page-title">Year {{ year }} - All persons</h2>

    <div class="month-grid">
        <table class="month-schedule table-sticky">
            <thead>
                {% if person_ob_totals is defined and person_ob_totals %}
                    {% set max_ob = person_ob_totals | max %}
                    {% set min_ob = person_ob_totals | min %}
                    <tr>
                        <th>Max OB</th>
                        <th>Difference</th>
                        {% for tot in person_ob_totals %}
                            <th class="num">{{ "%.2f"|format(tot) }}</th>
                        {% endfor %}
                    </tr>
                    <tr>
                        <th>{{ "%.2f"|format(max_ob) }}</th>
                        <th>{{ "%.2f"|format(max_ob - min_ob) }}</th>
                        {% for _ in person_ob_totals %}
                            <th></th>
                        {% endfor %}
                    </tr>
                {% endif %}
                <tr>
                    <th style="min-width:120px">Day</th>
                    <th style="min-width:140px">Date</th>
                    {% if days and days|length > 0 %}
                        {% for p in days[0].persons %}
                            <th class="person-header">
                                <a href="/year/{{ p.person_id }}">
                                {{ p.person_name }}<br>
                                <small>(#{{ p.person_id }})</small>
                                </a>
                            </th>
                        {% endfor %}
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for day in days %}
                    <tr class="shift-row {% if today is defined and day.date == today %}today-row{% endif %}">
                        <td class="day-cell">{{ day.weekday_name }}</td>
                        <td class="date-cell">{{ day.date }}</td>
                        {% for person in day.persons %}
                            <td style="border-left:6px solid {% if person.shift %}{{ person.shift.color }}{% else %}transparent{% endif %}; padding-left:8px;">
                                {% if person.shift %}
                                    <a href="/day/{{ person.person_id }}/{{ day.date.year }}/{{ day.date.month }}/{{ day.date.day }}"
                                       style="text-decoration:none;">
                                        <span class="badge"
                                              style="background: {{ person.shift.color }}; color: {{ person.shift.color | contrast }};">
                                            {{ person.shift.code }}
                                        </span>
                                    </a>
                                {% else %}
                                    <span class="badge badge-off">OFF</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="month-nav">
            <a href="/year?year={{ year - 1 }}" class="btn btn-primary">Previous year</a>
            <a href="/year?year={{ year + 1 }}" class="btn btn-primary">Next year</a>

            <h2>Year {{ year }}</h2>

            {% for i in range(1, 11) %}
                <a href="/year/{{ i }}?year={{ year }}" class="btn">{{ i }}</a>
            {% endfor %}
        </div>
    </div>

{{ super() }}

{% endblock %}
