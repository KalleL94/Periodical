{# app/templates/week.html #}
{% extends "base.html" %}

{% block page_content %}

<div class="page-header">
    <div class="page-header-left">
        <a href="/week/{{ person_id }}?year={{ year - 1 }}&week={{ week }}" class="btn btn-primary">Prev year</a>
        <a href="/week/{{ person_id }}?year={{ prev_year }}&week={{ prev_week }}" class="btn btn-primary">Prev week</a>
        <a href="/week/{{ person_id }}" class="btn btn-primary">Today</a>
        <a href="/week/{{ person_id }}?year={{ next_year }}&week={{ next_week }}" class="btn btn-primary">Next week</a>
        <a href="/week/{{ person_id }}?year={{ year + 1 }}&week={{ week }}" class="btn btn-primary">Next year</a>
    </div>

    <div class="page-header-right">
        <a href="/week?year={{ year }}&week={{ week }}" class="btn secondary">All</a>
        {# Navigering mellan personer - endast för admin #}
        {% if user and user.role.value == 'admin' %}
            {% for i in range(1, 11) %}
                <a href="/week/{{ i }}?year={{ year }}&week={{ week }}"
                   class="btn secondary {% if i == person_id %}btn-person-active{% endif %}">
                    {{ i }}
                </a>
            {% endfor %}
        {% endif %}
    </div>
</div>

<h2 class="page-title">Week {{ week }} {{ year }} - Person {{ person_id }}</h2>

{# Calendar grid view for week #}
{% set weekday_names_short = ['Mån', 'Tis', 'Ons', 'Tor', 'Fre', 'Lör', 'Sön'] %}

<table class="calendar-grid week-grid-single">
    <thead>
        <tr>
            {% for day_name in weekday_names_short %}
                <th>{{ day_name }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        <tr>
            {% for day in days %}
                {% set is_today = today is defined and day.date == today %}

                <td class="calendar-day {% if is_today %}today-cell{% endif %}"
                    style="border-top: 4px solid {% if day.shift %}{{ day.shift.color }}{% else %}#333{% endif %};">

                    <div class="calendar-day-content">
                        <div class="calendar-day-header">
                            <a href="/day/{{ person_id }}/{{ day.date.year }}/{{ day.date.month }}/{{ day.date.day }}"
                               class="day-number">
                                {{ day.date.day }}/{{ day.date.month }}
                            </a>
                            {# Show rotation week on each day for easy reference #}
                            {% if day.date.weekday() == 6 %}
                            <div class="calendar-rotation-week">Rot. v{{ day.rotation_week }}/{{ day.rotation_length }}</div>
                            {% endif %}
                            {% if day.date.weekday() == 0 %}
                                <span class="rotation-week-small">v{{ day.date.isocalendar()[1] }}</span>
                            {% endif %}
                            
                        </div>
                        

                        <div class="calendar-day-body">
                            {% if day.shift %}
                                <span class="badge calendar-badge"
                                      style="background: {{ day.shift.color }}; color: {{ day.shift.color | contrast }};">
                                    {{ day.shift.code }}
                                </span>
                            {% else %}
                                <span class="badge badge-off calendar-badge">OFF</span>
                            {% endif %}

                            {% if day.shift and day.shift.code != 'OC' %}
                                {% if day.shift.code == 'OT' and day.start and day.end %}
                                    <div class="calendar-time">{{ day.start.strftime('%H:%M') }} - {{ day.end.strftime('%H:%M') }}</div>
                                {% elif day.shift.start_time is not none %}
                                    <div class="calendar-time">{{ day.shift.start_time }} - {{ day.shift.end_time }}</div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </td>
            {% endfor %}
        </tr>
    </tbody>
</table>

{% endblock %}
