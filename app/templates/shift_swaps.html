{# app/templates/shift_swaps.html #}
{% extends "base.html" %}

{% block title %}Periodical – Skiftbyten{% endblock %}

{% block page_content %}
<section>
    <h2>Skiftbyten</h2>

    {% if pending_count > 0 %}
    <div class="card" style="border-color: var(--warning); margin-bottom: 1.5rem;">
        <strong style="color: var(--warning);">{{ pending_count }} väntande förfrågan{{ 'gar' if pending_count > 1 }}</strong>
    </div>
    {% endif %}

    <h3>Mottagna förfrågningar</h3>
    {% if received_swaps %}
    <table class="summary">
        <thead>
            <tr>
                <th>Från</th>
                <th>Ger dig</th>
                <th>Vill ha</th>
                <th>Meddelande</th>
                <th>Status</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for swap in received_swaps %}
            <tr class="shift-row">
                <td data-label="Från">{{ swap.requester.name }}</td>
                <td data-label="Ger dig">{{ swap.requester_shift_code or '?' }} ({{ swap.requester_date }})</td>
                <td data-label="Vill ha">{{ swap.target_shift_code or '?' }} ({{ swap.target_date }})</td>
                <td data-label="Meddelande">{{ swap.message or '-' }}</td>
                <td data-label="Status">
                    {% if swap.status.value == 'PENDING' %}
                        <span class="badge" style="background: var(--warning); color: #000;">Väntande</span>
                    {% elif swap.status.value == 'ACCEPTED' %}
                        <span class="badge" style="background: var(--accent-2); color: #000;">Accepterat</span>
                    {% elif swap.status.value == 'REJECTED' %}
                        <span class="badge" style="background: var(--danger); color: #fff;">Avvisat</span>
                    {% else %}
                        <span class="badge badge-off">Avbrutet</span>
                    {% endif %}
                </td>
                <td>
                    {% if swap.status.value == 'PENDING' %}
                        <form method="POST" action="/swaps/{{ swap.id }}/accept" style="display:inline;">
                            <button type="submit" class="btn" style="font-size:0.8rem; padding:0.3rem 0.6rem;">Acceptera</button>
                        </form>
                        <form method="POST" action="/swaps/{{ swap.id }}/reject" style="display:inline; margin-left:0.25rem;">
                            <button type="submit" class="btn btn-danger" style="font-size:0.8rem;">Avvisa</button>
                        </form>
                    {% elif swap.status.value == 'ACCEPTED' %}
                        <form method="POST" action="/swaps/{{ swap.id }}/cancel" style="display:inline;">
                            <button type="submit" class="btn btn-danger" style="font-size:0.8rem;"
                                    onclick="return confirm('Ångra accepterat byte?')">Ångra</button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="info-text">Inga mottagna förfrågningar.</p>
    {% endif %}

    <h3 style="margin-top: 2rem;">Skickade förfrågningar</h3>
    {% if sent_swaps %}
    <table class="summary">
        <thead>
            <tr>
                <th>Till</th>
                <th>Du ger</th>
                <th>Du får</th>
                <th>Status</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for swap in sent_swaps %}
            <tr class="shift-row">
                <td data-label="Till">{{ swap.target.name }}</td>
                <td data-label="Du ger">{{ swap.requester_shift_code or '?' }} ({{ swap.requester_date }})</td>
                <td data-label="Du får">{{ swap.target_shift_code or '?' }} ({{ swap.target_date }})</td>
                <td data-label="Status">
                    {% if swap.status.value == 'PENDING' %}
                        <span class="badge" style="background: var(--warning); color: #000;">Väntande</span>
                    {% elif swap.status.value == 'ACCEPTED' %}
                        <span class="badge" style="background: var(--accent-2); color: #000;">Accepterat</span>
                    {% elif swap.status.value == 'REJECTED' %}
                        <span class="badge" style="background: var(--danger); color: #fff;">Avvisat</span>
                    {% else %}
                        <span class="badge badge-off">Avbrutet</span>
                    {% endif %}
                </td>
                <td>
                    {% if swap.status.value in ('PENDING', 'ACCEPTED') %}
                        <form method="POST" action="/swaps/{{ swap.id }}/cancel" style="display:inline;">
                            <button type="submit" class="btn btn-danger" style="font-size:0.8rem;"
                                    onclick="return confirm('{{ 'Ångra accepterat byte?' if swap.status.value == 'ACCEPTED' else 'Avbryta bytet?' }}')">
                                {{ 'Ångra' if swap.status.value == 'ACCEPTED' else 'Avbryt' }}
                            </button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="info-text">Inga skickade förfrågningar.</p>
    {% endif %}
</section>
{% endblock %}
